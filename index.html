<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fan Control Curve圖檔建立</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --panel-bg: #1a1a1a;
            --card-bg: #242424;
            --accent-green: #00ff41;
            --accent-blue: #00d4ff;
            --border-color: #444444;
            --text-primary: #ffffff; 
            --text-secondary: #cccccc;
        }
        body {
            background-color: var(--panel-bg);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .industrial-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-top: 4px solid var(--accent-green);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        .input-industrial {
            background: #000000;
            border: 1px solid #555;
            color: var(--accent-green);
            font-family: inherit;
        }
        .input-industrial:focus {
            border-color: var(--accent-green);
            outline: none;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.4);
        }
        .btn-industrial {
            background: var(--accent-green);
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
        }
        .btn-industrial:hover {
            background: #33ff66;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);
        }
        /* 定製滾動條 */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }
        
        table { border-collapse: collapse; width: 100%; }
        th { text-align: left; color: #888; font-size: 11px; text-transform: uppercase; padding: 12px 8px; border-bottom: 2px solid #333; }
        td { padding: 12px 8px; border-bottom: 1px solid #222; font-size: 14px; color: #fff; font-weight: 500; }
        .row-temp { color: var(--accent-green); font-weight: 700; }
        
        /* 圖表容器 - 調整寬度比例 */
        .chart-container {
            padding-left: 5%;
            padding-right: 5%;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-6 flex flex-col md:flex-row md:items-end justify-between border-b border-zinc-600 pb-4">
            <div>
                <h1 class="text-2xl font-black text-white flex items-center">
                    <span class="bg-emerald-500 text-black px-2 py-1 mr-2 text-sm italic">SYSTEM</span>
                    FAN PWM CONTROL CONSOLE V2.5
                </h1>
                <p class="text-zinc-400 text-xs mt-1 tracking-tighter"></p>
            </div>
            <div class="text-right text-xs text-zinc-400 font-mono mt-4 md:mt-0">
                STATUS: <span class="text-emerald-400 animate-pulse">● OPERATIONAL</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- 配置與表格區 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 數據輸入卡片 -->
                <div class="industrial-card p-5">
                    <h2 class="text-xs font-bold mb-4 text-white uppercase tracking-widest border-b border-zinc-700 pb-2 flex items-center">
                        <svg class="w-4 h-4 mr-2 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        數據輸入 (Entry)
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] text-zinc-300 uppercase mb-1 font-bold">Profile ID (名稱代號)</label>
                            <input type="text" id="profileId" class="input-industrial w-full p-2 text-base rounded italic" placeholder="例如：CASE_FAN_FRONT" oninput="updateProfileDisplay()">
                        </div>
                        <div>
                            <label class="block text-[10px] text-zinc-300 uppercase mb-1 font-bold">Temperature (°C)</label>
                            <input type="number" id="tempInput" class="input-industrial w-full p-2 text-base rounded" placeholder="0-100">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[10px] text-zinc-300 uppercase mb-1 font-bold text-xs">Fan Duty (%)</label>
                                <input type="number" id="percentInput" oninput="syncFromPercent()" class="input-industrial w-full p-2 text-base rounded" placeholder="0-100" step="0.1">
                            </div>
                            <div>
                                <label class="block text-[10px] text-zinc-300 uppercase mb-1 font-bold text-xs">BIOS PWM (0-255)</label>
                                <input type="number" id="dutyInput" oninput="syncFromPwm()" class="input-industrial w-full p-2 text-base rounded" placeholder="0-255">
                            </div>
                        </div>
                        <button onclick="addDataPoint()" class="btn-industrial w-full py-3 rounded text-base">
                            Add Point
                        </button>
                    </div>
                </div>

                <!-- 數據表格卡片 -->
                <div class="industrial-card p-4 border-t-emerald-500">
                    <h2 class="text-[10px] font-bold mb-3 text-white uppercase tracking-widest flex items-center justify-between">
                        <span class="flex items-center">
                            <svg class="w-3 h-3 mr-2 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            數據表格 (Table)
                        </span>
                        <span id="tableTitleSuffix" class="text-emerald-500 italic text-[9px] opacity-80"></span>
                    </h2>
                    <div class="overflow-y-auto max-h-[400px] bg-black rounded border border-zinc-800">
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th>Temp°C</th>
                                    <th>Duty%</th>
                                    <th>PWM</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- 表格行將在此動態生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 視覺化區 -->
            <div class="lg:col-span-3">
                <!-- Duty Chart Only - 調整高度與顏色 -->
                <div class="industrial-card p-5 border-t-emerald-500">
                    <h2 class="text-xs font-bold mb-4 text-white uppercase tracking-widest flex items-center justify-between">
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                            Fan Duty Cycle (%) <span id="dutyTitleSuffix" class="ml-2 text-emerald-400 italic opacity-70 underline"></span>
                        </span>
                    </h2>
                    <div class="relative h-[350px] w-full bg-[#050505] rounded border border-zinc-800 p-6 chart-container">
                        <canvas id="dutyChart"></canvas>
                    </div>
                </div>
                
                <!-- 底部裝飾資訊 -->
                <div class="mt-4 grid grid-cols-3 gap-4">
                    <div class="p-3 border border-zinc-800 rounded bg-[#1a1a1a] text-[10px] text-zinc-500 font-mono">
                        Creator: Randy Chen
                    </div>
                    <div class="p-3 border border-zinc-800 rounded bg-[#1a1a1a] text-[10px] text-zinc-500 font-mono">
                        SAMP_RATE: 1000HZ
                    </div>
                    <div class="p-3 border border-zinc-800 rounded bg-[#1a1a1a] text-[10px] text-zinc-500 font-mono">
                        MODE: LINEAR_INTERPOLATION
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 新增：阻擋右鍵選單功能 ---
        document.addEventListener('contextmenu', function(event) {
            event.preventDefault();
        });
        // --------------------------

        let dataPoints = [
            { temp: 25, duty: 50 },
            { temp: 55, duty: 120 },
            { temp: 85, duty: 255 }
        ];
        let dutyChart;

        function updateProfileDisplay() {
            const profile = document.getElementById('profileId').value.trim();
            const suffix = profile ? `[ID: ${profile}]` : '';
            
            document.getElementById('dutyTitleSuffix').textContent = suffix;
            document.getElementById('tableTitleSuffix').textContent = suffix;
        }

        function syncFromPercent() {
            const percent = parseFloat(document.getElementById('percentInput').value);
            if (!isNaN(percent)) {
                const pwm = Math.round((percent / 100) * 255);
                document.getElementById('dutyInput').value = Math.min(255, Math.max(0, pwm));
            } else {
                document.getElementById('dutyInput').value = '';
            }
        }

        function syncFromPwm() {
            const pwm = parseInt(document.getElementById('dutyInput').value);
            if (!isNaN(pwm)) {
                const percent = ((pwm / 255) * 100).toFixed(1);
                document.getElementById('percentInput').value = percent;
            } else {
                document.getElementById('percentInput').value = '';
            }
        }

        function initCharts() {
            Chart.defaults.color = '#999'; 
            Chart.defaults.font.family = "'JetBrains Mono', monospace";
            
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#000',
                        borderColor: '#555',
                        borderWidth: 1,
                        cornerRadius: 0,
                        padding: 10
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        grid: { color: '#2a2a2a' },
                        title: { 
                            display: true, 
                            text: 'Temperature (°C)', 
                            color: '#888', 
                            font: { size: 12, weight: '700' }
                        },
                        ticks: { font: { size: 10 } }
                    },
                    y: {
                        grid: { color: '#2a2a2a' },
                        beginAtZero: true,
                        ticks: { font: { size: 11 } }
                    }
                }
            };

            const ctxDuty = document.getElementById('dutyChart').getContext('2d');
            dutyChart = new Chart(ctxDuty, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Duty %',
                        data: dataPoints.map(p => ({ x: p.temp, y: (p.duty / 255) * 100 })),
                        borderColor: '#00ff41', 
                        borderWidth: 3,
                        backgroundColor: 'rgba(0, 255, 65, 0.1)',
                        fill: true,
                        tension: 0,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#00ff41',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        y: { 
                            ...commonOptions.scales.y, 
                            min: 0, 
                            max: 120, 
                            title: { display: true, text: 'Duty Cycle (%)', color: '#666', font: { size: 11 } } 
                        }
                    }
                }
            });
        }

        function addDataPoint() {
            const temp = parseInt(document.getElementById('tempInput').value);
            const duty = parseInt(document.getElementById('dutyInput').value);

            if (isNaN(temp) || isNaN(duty)) return;

            const clampedDuty = Math.min(255, Math.max(0, duty));
            const existingIndex = dataPoints.findIndex(p => p.temp === temp);
            
            if (existingIndex > -1) {
                dataPoints[existingIndex].duty = clampedDuty;
            } else {
                dataPoints.push({ temp, duty: clampedDuty });
            }

            dataPoints.sort((a, b) => a.temp - b.temp);
            
            updateUI();
            updateProfileDisplay();
            
            document.getElementById('tempInput').value = '';
            document.getElementById('dutyInput').value = '';
            document.getElementById('percentInput').value = '';
            document.getElementById('tempInput').focus();
        }

        function removePoint(temp) {
            dataPoints = dataPoints.filter(p => p.temp !== temp);
            updateUI();
        }

        function updateUI() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            dataPoints.forEach((p, index) => {
                const pct = ((p.duty / 255) * 100).toFixed(1);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="row-temp">${p.temp}</td>
                    <td>${pct}%</td>
                    <td class="font-mono text-zinc-300">${p.duty}</td>
                    <td class="text-right">
                        <button onclick="removePoint(${p.temp})" class="text-red-500 hover:text-red-300 transition-colors p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            dutyChart.data.datasets[0].data = dataPoints.map(p => ({ x: p.temp, y: (p.duty / 255) * 100 }));
            dutyChart.update();
        }

        window.onload = () => {
            initCharts();
            updateUI();
            updateProfileDisplay();
        };
    </script>
</body>

</html>
